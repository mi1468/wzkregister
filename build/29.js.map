{"version":3,"sources":["../../src/pages/draw/draw.module.ts","../../src/pages/draw/draw.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AAAyC;AACO;AACd;AAUlC;IAAA;IAA6B,CAAC;IAAjB,cAAc;QAR1B,uEAAQ,CAAC;YACR,YAAY,EAAE;gBACZ,uDAAQ;aACT;YACD,OAAO,EAAE;gBACP,sEAAe,CAAC,QAAQ,CAAC,uDAAQ,CAAC;aACnC;SACF,CAAC;OACW,cAAc,CAAG;IAAD,qBAAC;CAAA;AAAH;;;;;;;;;;;;;;;;;;;;;;ACZoC;AACU;AAGlB;AAEvD;;;;;GAKG;AAOH;IAiBI,kBAAmB,OAAsB,EAAS,SAAoB,EAAS,QAAwB,EAAU,YAA0B;QAAxH,YAAO,GAAP,OAAO,CAAe;QAAS,cAAS,GAAT,SAAS,CAAW;QAAS,aAAQ,GAAR,QAAQ,CAAgB;QAAU,iBAAY,GAAZ,YAAY,CAAc;QAdnI,gBAAW,GAAG,KAAK,CAAC;QACpB,QAAG,GAA6B,IAAI,CAAC;QACrC,UAAK,GAAG,CAAC,CAAC;QACV,UAAK,GAAG,CAAC,CAAC;QACV,cAAS,GAAG,IAAI,CAAC;QACjB,YAAO,GAAQ,IAAI,CAAC;QACpB,cAAS,GAAG,EAAE,CAAC;QACf,SAAI,GAAG,OAAO,CAAC;QAQnB,IAAI,CAAC,SAAS,GAAG,SAAS,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;QACtC,IAAI,CAAC,IAAI,GAAG,SAAS,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;QAClC,IAAI,CAAC,MAAM,GAAG,SAAS,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;IAC1C,CAAC;IARD,6BAAU,GAAV;QACI,IAAI,CAAC,WAAW,GAAG,KAAK,CAAC;IAC7B,CAAC;IAQD,0BAAO,GAAP;QACI,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,SAAS,CAAC,aAAa,CAAC,KAAK,EAAE,IAAI,CAAC,SAAS,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;IACtG,CAAC;IAED,0BAAO,GAAP;QACI,OAAO,CAAC,GAAG,CAAC,UAAU,CAAC;QACvB,IAAI,CAAC,WAAW,GAAG,KAAK,CAAC;IAC7B,CAAC;IAED,4BAAS,GAAT,UAAU,CAAC;QACP,OAAO,CAAC,GAAG,CAAC,YAAY,CAAC;QACzB,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;QACxB,IAAI,CAAC,GAAG,CAAC,SAAS,GAAG,QAAQ,CAAC;QAC9B,IAAM,SAAS,GAAG,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,SAAS,CAAC,aAAa,CAAC;QAChE,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC,OAAO,GAAG,SAAS,CAAC,CAAC,CAAC;QACrC,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC,OAAO,GAAG,SAAS,CAAC,CAAC,CAAC;QACrC,IAAI,CAAC,GAAG,CAAC,SAAS,EAAE,CAAC;IACzB,CAAC;IAED,2BAAQ,GAAR;QACI,IAAM,EAAE,GAAG,IAAI,CAAC;QAChB,IAAI,CAAC,YAAY,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,SAAS,CAAC,GAAG,IAAI,CAAC,QAAQ,EAAE,CAAC;QAE5E,IAAI,CAAC,QAAQ,CAAC,OAAO,EAAE,CAAC;QAExB,IAAI,CAAC,YAAY,CAAC,YAAY,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,SAAS,CAAC,aAAa,EAAE,IAAI,CAAC,MAAM,EAAE,UAAC,IAAI;YACvG,gCAAgC;QACxB,CAAC,CAAC;IACN,CAAC;IAED,4BAAS,GAAT,UAAU,CAAC;QACP,OAAO,CAAC,GAAG,CAAC,YAAY,CAAC;QACzB,IAAI,CAAC,IAAI,CAAC,WAAW;YAAE,OAAO;QAE9B,IAAI,IAAI,CAAC,SAAS,IAAI,IAAI;YAAE,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,SAAS,CAAC,aAAa,CAAC;QAE3F,IAAI,SAAS,GAAG,CAAC,CAAC,OAAO,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC;QAC7C,IAAI,SAAS,GAAG,CAAC,CAAC,OAAO,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC;QAC7C,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC;QACxC,IAAI,CAAC,KAAK,GAAG,SAAS,CAAC;QACvB,IAAI,CAAC,KAAK,GAAG,SAAS,CAAC;QACvB,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC;QACxC,IAAI,CAAC,GAAG,CAAC,SAAS,GAAC,CAAC,CAAC;QACrB,IAAI,CAAC,GAAG,CAAC,WAAW,GAAC,cAAc,CAAC;QACpC,IAAI,CAAC,GAAG,CAAC,MAAM,EAAE,CAAC;IACtB,CAAC;IAEO,8BAAW,GAAnB,UAAoB,EAAE;QAClB,IAAI,SAAS,GAAG,CAAC,CAAC;QAClB,IAAI,SAAS,GAAG,CAAC,CAAC;QAIlB,OAAO,EAAE,EAAE;YACP,IAAI,EAAE,CAAC,OAAO,IAAI,MAAM,EAAE;gBACtB,qEAAqE;gBACrE,IAAI,UAAU,GAAG,EAAE,CAAC,UAAU,IAAI,QAAQ,CAAC,eAAe,CAAC,UAAU,CAAC;gBACtE,IAAI,UAAU,GAAG,EAAE,CAAC,SAAS,IAAI,QAAQ,CAAC,eAAe,CAAC,SAAS,CAAC;gBACpE,SAAS,IAAI,CAAC,EAAE,CAAC,UAAU,GAAG,UAAU,GAAG,EAAE,CAAC,UAAU,CAAC,CAAC;gBAC1D,SAAS,IAAI,CAAC,EAAE,CAAC,SAAS,GAAG,UAAU,GAAG,EAAE,CAAC,SAAS,CAAC,CAAC;aAC3D;iBAAM;gBACH,SAAS,IAAI,CAAC,EAAE,CAAC,UAAU,GAAG,EAAE,CAAC,UAAU,GAAG,EAAE,CAAC,UAAU,CAAC,CAAC;gBAC7D,SAAS,IAAI,CAAC,EAAE,CAAC,SAAS,GAAG,EAAE,CAAC,SAAS,GAAG,EAAE,CAAC,SAAS,CAAC,CAAC;aAC7D;YACD,EAAE,GAAG,EAAE,CAAC,YAAY,CAAC;SACxB;QACD,OAAO;YACH,CAAC,EAAE,SAAS;YACZ,CAAC,EAAE,SAAS;SACf,CAAC;IACN,CAAC;IAEO,2BAAQ,GAAhB;QACI,OAAO,IAAI,CAAC,SAAS,CAAC,aAAa,CAAC,SAAS,CAAC,WAAW,CAAC;IAC9D,CAAC;IAGO,gCAAa,GAArB,UAAsB,GAAG,EAAE,GAAG,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,OAAO,EAAE,OAAO;QAExD,IAAI,SAAS,CAAC,MAAM,KAAK,CAAC,EAAE;YACxB,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;YACV,CAAC,GAAG,GAAG,CAAC,MAAM,CAAC,KAAK,CAAC;YACrB,CAAC,GAAG,GAAG,CAAC,MAAM,CAAC,MAAM,CAAC;SACzB;QAED,2BAA2B;QAC3B,OAAO,GAAG,OAAO,OAAO,KAAK,QAAQ,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,GAAG,CAAC;QACtD,OAAO,GAAG,OAAO,OAAO,KAAK,QAAQ,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,GAAG,CAAC;QAEtD,yBAAyB;QACzB,IAAI,OAAO,GAAG,CAAC;YAAE,OAAO,GAAG,CAAC,CAAC;QAC7B,IAAI,OAAO,GAAG,CAAC;YAAE,OAAO,GAAG,CAAC,CAAC;QAC7B,IAAI,OAAO,GAAG,CAAC;YAAE,OAAO,GAAG,CAAC,CAAC;QAC7B,IAAI,OAAO,GAAG,CAAC;YAAE,OAAO,GAAG,CAAC,CAAC;QAE7B,IAAI,EAAE,GAAG,GAAG,CAAC,KAAK,EACd,EAAE,GAAG,GAAG,CAAC,MAAM,EACf,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,GAAG,EAAE,EAAE,CAAC,GAAG,EAAE,CAAC,EAC5B,EAAE,GAAG,EAAE,GAAG,CAAC,EAAI,kBAAkB;QACjC,EAAE,GAAG,EAAE,GAAG,CAAC,EAAI,mBAAmB;QAClC,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAG,CAAC,CAAC;QAE3B,2BAA2B;QAC3B,IAAI,EAAE,GAAG,CAAC;YAAE,EAAE,GAAG,CAAC,GAAG,EAAE,CAAC;QACxB,IAAI,IAAI,CAAC,GAAG,CAAC,EAAE,GAAG,CAAC,CAAC,GAAG,KAAK,IAAI,EAAE,GAAG,CAAC;YAAE,EAAE,GAAG,CAAC,GAAG,EAAE,CAAC,CAAE,UAAU;QAChE,EAAE,IAAI,EAAE,CAAC;QACT,EAAE,IAAI,EAAE,CAAC;QAET,wBAAwB;QACxB,EAAE,GAAG,EAAE,GAAG,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC;QACnB,EAAE,GAAG,EAAE,GAAG,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC;QAEnB,EAAE,GAAG,CAAC,EAAE,GAAG,EAAE,CAAC,GAAG,OAAO,CAAC;QACzB,EAAE,GAAG,CAAC,EAAE,GAAG,EAAE,CAAC,GAAG,OAAO,CAAC;QAEzB,sCAAsC;QACtC,IAAI,EAAE,GAAG,CAAC;YAAE,EAAE,GAAG,CAAC,CAAC;QACnB,IAAI,EAAE,GAAG,CAAC;YAAE,EAAE,GAAG,CAAC,CAAC;QACnB,IAAI,EAAE,GAAG,EAAE;YAAE,EAAE,GAAG,EAAE,CAAC;QACrB,IAAI,EAAE,GAAG,EAAE;YAAE,EAAE,GAAG,EAAE,CAAC;QAErB,gCAAgC;QAChC,GAAG,CAAC,SAAS,CAAC,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;IACnD,CAAC;IAED,iCAAc,GAAd;QAAA,iBAsDC;QArDG,IAAM,EAAE,GAAG,IAAI,CAAC;QAChB,OAAO,CAAC,GAAG,CAAC,yBAAyB,CAAC,CAAC;QACvC,IAAI,CAAC,GAAG,GAAG,IAAI,CAAC,SAAS,CAAC,aAAa,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;QACzD,gCAAgC;QAChC,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC,EAAE,CAAC,EAAE,GAAG,EAAE,GAAG,CAAC,CAAC;QAEnC,IAAI,IAAI,CAAC,YAAY,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,IAAI,EAAE;YACnE,IAAM,KAAG,GAAG,IAAI,KAAK,EAAE,CAAC;YACxB,KAAG,CAAC,GAAG,GAAG,IAAI,CAAC,YAAY,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC;YACpE,KAAG,CAAC,MAAM,GAAG;gBACT,KAAI,CAAC,GAAG,CAAC,SAAS,CAAC,KAAG,EAAE,CAAC,EAAE,CAAC,CAAC;YACjC,CAAC;SACJ;QAED,IAAI,CAAC,SAAS,CAAC,aAAa,CAAC,gBAAgB,CAAC,YAAY,EAAE,SAAS,SAAS,CAAC,CAAC;YAC5E,OAAO,CAAC,GAAG,CAAC,YAAY,CAAC;YACzB,EAAE,CAAC,WAAW,GAAG,IAAI,CAAC;YACtB,EAAE,CAAC,GAAG,CAAC,SAAS,GAAG,QAAQ,CAAC;YAC5B,EAAE,CAAC,GAAG,CAAC,WAAW,GAAC,cAAc,CAAC;YAClC,EAAE,CAAC,GAAG,CAAC,SAAS,GAAC,CAAC,CAAC;YAEnB,IAAI,QAAQ,GAAG,EAAE,CAAC,GAAG,CAAC,oBAAoB,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;YACvD,QAAQ,CAAC,YAAY,CAAC,CAAC,EAAE,SAAS,CAAC,CAAC;YACpC,QAAQ,CAAC,YAAY,CAAC,GAAG,EAAE,MAAM,CAAC,CAAC;YACnC,QAAQ,CAAC,YAAY,CAAC,GAAG,EAAE,KAAK,CAAC,CAAC;YAClC,qBAAqB;YACrB,EAAE,CAAC,GAAG,CAAC,WAAW,GAAG,QAAQ,CAAC;YAE9B,IAAM,SAAS,GAAG,EAAE,CAAC,WAAW,CAAC,EAAE,CAAC,SAAS,CAAC,aAAa,CAAC;YAC5D,EAAE,CAAC,KAAK,GAAG,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,OAAO,GAAG,SAAS,CAAC,CAAC,CAAC;YAC9C,EAAE,CAAC,KAAK,GAAG,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,OAAO,GAAG,SAAS,CAAC,CAAC,CAAC;YAC9C,EAAE,CAAC,GAAG,CAAC,SAAS,EAAE,CAAC;QACvB,CAAC,EAAE,KAAK,CAAC;QACT,IAAI,CAAC,SAAS,CAAC,aAAa,CAAC,gBAAgB,CAAC,WAAW,EAAE,SAAS,SAAS,CAAC,CAAC;YAC3E,OAAO,CAAC,GAAG,CAAC,YAAY,CAAC;YACzB,IAAI,CAAC,EAAE,CAAC,WAAW;gBAAE,OAAO;YAE5B,IAAI,EAAE,CAAC,SAAS,IAAI,IAAI;gBAAE,EAAE,CAAC,SAAS,GAAG,EAAE,CAAC,WAAW,CAAC,EAAE,CAAC,SAAS,CAAC,aAAa,CAAC,CAAC;YAEpF,IAAI,SAAS,GAAG,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,OAAO,GAAG,EAAE,CAAC,SAAS,CAAC,CAAC,CAAC;YACtD,IAAI,SAAS,GAAG,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,OAAO,GAAG,EAAE,CAAC,SAAS,CAAC,CAAC,CAAC;YACtD,OAAO,CAAC,GAAG,CAAC,SAAS,EAAE,SAAS,CAAC,CAAC;YAClC,EAAE,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,KAAK,EAAE,EAAE,CAAC,KAAK,CAAC,CAAC;YAClC,EAAE,CAAC,KAAK,GAAG,SAAS,CAAC;YACrB,EAAE,CAAC,KAAK,GAAG,SAAS,CAAC;YACrB,EAAE,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,KAAK,EAAE,EAAE,CAAC,KAAK,CAAC,CAAC;YAClC,EAAE,CAAC,GAAG,CAAC,SAAS,GAAC,CAAC,CAAC;YAEnB,EAAE,CAAC,GAAG,CAAC,WAAW,GAAC,cAAc,CAAC;YAElC,EAAE,CAAC,GAAG,CAAC,MAAM,EAAE,CAAC;QACpB,CAAC,EAAE,KAAK,CAAC;QACT,IAAI,CAAC,SAAS,CAAC,aAAa,CAAC,gBAAgB,CAAC,UAAU,EAAE,IAAI,CAAC,OAAO,EAAE,EAAE,KAAK,CAAC;IACpF,CAAC;IAzMwB;QAAxB,yEAAS,CAAC,YAAY,CAAC;kCAAY,iEAAU;+CAAC;IADtC,QAAQ;QAJpB,wEAAS,CAAC;YACP,QAAQ,EAAE,WAAW;WACG;SAC3B,CAAC;iBAkB6I;OAjBlI,QAAQ,CA4MpB;IAAD,CAAC;AAAA;SA5MY,QAAQ,e","file":"29.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { DrawPage } from './draw';\n\n@NgModule({\n  declarations: [\n    DrawPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(DrawPage),\n  ],\n})\nexport class DrawPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/draw/draw.module.ts","import {Component, ElementRef, ViewChild} from '@angular/core';\nimport {IonicPage, NavController, NavParams, ViewController} from 'ionic-angular';\nimport {getType} from \"@angular/core/src/errors\";\nimport {CheckinServiceProvider} from \"../../providers/checkin-service/checkin-service\";\nimport {DrawProvider} from \"../../providers/draw/draw\";\n\n/**\n * Generated class for the DrawPage page.\n *\n * See https://ionicframework.com/docs/components/#navigation for more info on\n * Ionic pages and navigation.\n */\n\n@IonicPage()\n@Component({\n    selector: 'page-draw',\n    templateUrl: 'draw.html',\n})\nexport class DrawPage {\n    @ViewChild('drawCanvas') canvasRef: ElementRef;\n\n    private isMouseDown = false;\n    private ctx: CanvasRenderingContext2D = null;\n    private lastX = 0;\n    private lastY = 0;\n    private canvasPos = null;\n    private imgData: any = null;\n    private imagePath = \"\";\n    private kind = \"human\";\n    private parent;\n\n    mouseLeave() {\n        this.isMouseDown = false;\n    }\n\n    constructor(public navCtrl: NavController, public navParams: NavParams, public viewCtrl: ViewController, private dataProvider: DrawProvider) {\n        this.imagePath = navParams.get(\"img\");\n        this.kind = navParams.get(\"kind\");\n        this.parent = navParams.get(\"parent\");\n    }\n\n    restart() {\n        this.ctx.clearRect(0, 0, this.canvasRef.nativeElement.width, this.canvasRef.nativeElement.height);\n    }\n\n    mouseUp() {\n        console.log(\"Mouse up\")\n        this.isMouseDown = false;\n    }\n\n    mouseDown(e) {\n        console.log(\"Mouse down\")\n        this.isMouseDown = true;\n        this.ctx.fillStyle = 'DD0031';\n        const canvasPos = this.getPosition(this.canvasRef.nativeElement)\n        this.lastX = e.clientX - canvasPos.x;\n        this.lastY = e.clientY - canvasPos.y;\n        this.ctx.beginPath();\n    }\n\n    dissmiss() {\n        const me = this;\n        this.dataProvider.imageData[this.parent + this.imagePath] = this.getImage();\n\n        this.viewCtrl.dismiss();\n\n        this.dataProvider.processImage(this.imagePath, this.canvasRef.nativeElement, this.parent, (data) => {\n//            console.log(data);\n        })\n    }\n\n    mouseMove(e) {\n        console.log(\"Mouse move\")\n        if (!this.isMouseDown) return;\n\n        if (this.canvasPos == null) this.canvasPos = this.getPosition(this.canvasRef.nativeElement)\n\n        var xPosition = e.clientX - this.canvasPos.x;\n        var yPosition = e.clientY - this.canvasPos.y;\n        this.ctx.moveTo(this.lastX, this.lastY);\n        this.lastX = xPosition;\n        this.lastY = yPosition;\n        this.ctx.lineTo(this.lastX, this.lastY);\n        this.ctx.lineWidth=3;\n        this.ctx.strokeStyle='rgb(255,0,0)';\n        this.ctx.stroke();\n    }\n\n    private getPosition(el) {\n        var xPosition = 0;\n        var yPosition = 0;\n\n\n\n        while (el) {\n            if (el.tagName == \"BODY\") {\n                // deal with browser quirks with body/window/document and page scroll\n                var xScrollPos = el.scrollLeft || document.documentElement.scrollLeft;\n                var yScrollPos = el.scrollTop || document.documentElement.scrollTop;\n                xPosition += (el.offsetLeft - xScrollPos + el.clientLeft);\n                yPosition += (el.offsetTop - yScrollPos + el.clientTop);\n            } else {\n                xPosition += (el.offsetLeft - el.scrollLeft + el.clientLeft);\n                yPosition += (el.offsetTop - el.scrollTop + el.clientTop);\n            }\n            el = el.offsetParent;\n        }\n        return {\n            x: xPosition,\n            y: yPosition\n        };\n    }\n\n    private getImage() {\n        return this.canvasRef.nativeElement.toDataURL(\"image/png\")\n    }\n\n\n    private drawImageProp(ctx, img, x, y, w, h, offsetX, offsetY) {\n\n        if (arguments.length === 2) {\n            x = y = 0;\n            w = ctx.canvas.width;\n            h = ctx.canvas.height;\n        }\n\n        // default offset is center\n        offsetX = typeof offsetX === \"number\" ? offsetX : 0.5;\n        offsetY = typeof offsetY === \"number\" ? offsetY : 0.5;\n\n        // keep bounds [0.0, 1.0]\n        if (offsetX < 0) offsetX = 0;\n        if (offsetY < 0) offsetY = 0;\n        if (offsetX > 1) offsetX = 1;\n        if (offsetY > 1) offsetY = 1;\n\n        var iw = img.width,\n            ih = img.height,\n            r = Math.min(w / iw, h / ih),\n            nw = iw * r,   // new prop. width\n            nh = ih * r,   // new prop. height\n            cx, cy, cw, ch, ar = 1;\n\n        // decide which gap to fill\n        if (nw < w) ar = w / nw;\n        if (Math.abs(ar - 1) < 1e-14 && nh < h) ar = h / nh;  // updated\n        nw *= ar;\n        nh *= ar;\n\n        // calc source rectangle\n        cw = iw / (nw / w);\n        ch = ih / (nh / h);\n\n        cx = (iw - cw) * offsetX;\n        cy = (ih - ch) * offsetY;\n\n        // make sure source rectangle is valid\n        if (cx < 0) cx = 0;\n        if (cy < 0) cy = 0;\n        if (cw > iw) cw = iw;\n        if (ch > ih) ch = ih;\n\n        // fill image in dest. rectangle\n        ctx.drawImage(img, cx, cy, cw, ch, x, y, w, h);\n    }\n\n    ionViewDidLoad() {\n        const me = this;\n        console.log('ionViewDidLoad DrawPage');\n        this.ctx = this.canvasRef.nativeElement.getContext('2d');\n        // this.ctx.scale(2,2); // HiDPI\n        this.ctx.clearRect(0, 0, 400, 400);\n\n        if (this.dataProvider.imageData[this.parent + this.imagePath] != null) {\n            const img = new Image();\n            img.src = this.dataProvider.imageData[this.parent + this.imagePath];\n            img.onload = () => {\n                this.ctx.drawImage(img, 0, 0)\n            }\n        }\n\n        this.canvasRef.nativeElement.addEventListener(\"touchstart\", function mouseDown(e) {\n            console.log(\"Mouse down\")\n            me.isMouseDown = true;\n            me.ctx.fillStyle = 'DD0031';\n            me.ctx.strokeStyle='rgb(255,0,0)';\n            me.ctx.lineWidth=3;\n\n            var gradient = me.ctx.createLinearGradient(0, 0, 0, 0);\n            gradient.addColorStop(0, \"magenta\");\n            gradient.addColorStop(0.5, \"blue\");\n            gradient.addColorStop(1.0, \"red\");\n            // Fill with gradient\n            me.ctx.strokeStyle = gradient;\n\n            const canvasPos = me.getPosition(me.canvasRef.nativeElement)\n            me.lastX = e.touches[0].clientX - canvasPos.x;\n            me.lastY = e.touches[0].clientY - canvasPos.y;\n            me.ctx.beginPath();\n        }, false)\n        this.canvasRef.nativeElement.addEventListener(\"touchmove\", function mouseMove(e) {\n            console.log(\"Mouse move\")\n            if (!me.isMouseDown) return;\n\n            if (me.canvasPos == null) me.canvasPos = me.getPosition(me.canvasRef.nativeElement);\n\n            var xPosition = e.touches[0].clientX - me.canvasPos.x;\n            var yPosition = e.touches[0].clientY - me.canvasPos.y;\n            console.log(xPosition, yPosition);\n            me.ctx.moveTo(me.lastX, me.lastY);\n            me.lastX = xPosition;\n            me.lastY = yPosition;\n            me.ctx.lineTo(me.lastX, me.lastY);\n            me.ctx.lineWidth=3;\n\n            me.ctx.strokeStyle='rgb(255,0,0)';\n\n            me.ctx.stroke();\n        }, false)\n        this.canvasRef.nativeElement.addEventListener(\"touchend\", this.mouseUp(), false)\n    }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/draw/draw.ts"],"sourceRoot":""}